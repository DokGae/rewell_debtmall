<div class="max-w-2xl mx-auto">
  <h1 class="text-2xl font-bold mb-6">업체 정보 수정</h1>
  
  <div class="card p-6">
    <%= form_with model: [:admin, @business], local: true do |f| %>
      <div class="space-y-4">
        <div>
          <%= f.label :name, "업체명", class: "block text-sm font-medium mb-1" %>
          <%= f.text_field :name, required: true, class: "w-full" %>
          <% if @business.errors[:name].any? %>
            <p class="text-red-500 text-sm mt-1"><%= @business.errors[:name].first %></p>
          <% end %>
        </div>
        
        <div>
          <%= f.label :domain, "도메인", class: "block text-sm font-medium mb-1" %>
          <div class="flex items-center gap-2">
            <span class="text-zinc-400">도메인/</span>
            <%= f.text_field :domain, required: true, class: "flex-1", placeholder: "예: happy-store" %>
          </div>
          <p class="text-sm text-zinc-400 mt-1">소문자, 숫자, 하이픈(-)만 사용 가능합니다.</p>
          <% if @business.errors[:domain].any? %>
            <p class="text-red-500 text-sm mt-1"><%= @business.errors[:domain].first %></p>
          <% end %>
        </div>
        
        <div>
          <%= f.label :description, "설명", class: "block text-sm font-medium mb-1" %>
          <%= f.text_area :description, rows: 3, class: "w-full" %>
          <% if @business.errors[:description].any? %>
            <p class="text-red-500 text-sm mt-1"><%= @business.errors[:description].first %></p>
          <% end %>
        </div>
        
        <div class="grid grid-cols-2 gap-4">
          <div>
            <%= f.label :email, "이메일 (로그인용)", class: "block text-sm font-medium mb-1" %>
            <%= f.email_field :email, required: true, class: "w-full" %>
            <% if @business.errors[:email].any? %>
              <p class="text-red-500 text-sm mt-1"><%= @business.errors[:email].first %></p>
            <% end %>
          </div>
          
          <div>
            <%= f.label :phone, "전화번호", class: "block text-sm font-medium mb-1" %>
            <%= f.telephone_field :phone, required: true, class: "w-full" %>
            <% if @business.errors[:phone].any? %>
              <p class="text-red-500 text-sm mt-1"><%= @business.errors[:phone].first %></p>
            <% end %>
          </div>
        </div>
        
        <div class="border-t pt-4 mt-4">
          <h3 class="text-lg font-semibold mb-4">비밀번호 변경</h3>
          
          <div class="grid grid-cols-2 gap-4">
            <div>
              <%= label_tag :password, "새 비밀번호", class: "block text-sm font-medium mb-1" %>
              <%= password_field_tag "business[password]", nil, 
                  minlength: 8,
                  placeholder: "변경하지 않으려면 비워두세요",
                  class: "w-full" %>
              <% if @business.errors[:password].any? %>
                <p class="text-red-500 text-sm mt-1"><%= @business.errors[:password].first %></p>
              <% end %>
            </div>
            
            <div>
              <%= label_tag :password_confirmation, "비밀번호 확인", class: "block text-sm font-medium mb-1" %>
              <%= password_field_tag "business[password_confirmation]", nil, 
                  minlength: 8,
                  placeholder: "새 비밀번호 재입력",
                  class: "w-full" %>
              <% if @business.errors[:password_confirmation].any? %>
                <p class="text-red-500 text-sm mt-1"><%= @business.errors[:password_confirmation].first %></p>
              <% end %>
            </div>
          </div>
          
          <p class="text-sm text-zinc-400 mt-2">비밀번호를 변경하지 않으려면 비워두세요.</p>
          
          <% if @business.sign_in_count > 0 %>
            <div class="mt-4 p-4 bg-zinc-800 rounded">
              <h4 class="text-sm font-medium mb-2">로그인 정보</h4>
              <div class="text-sm text-zinc-400 space-y-1">
                <p>총 로그인 횟수: <%= @business.sign_in_count %>회</p>
                <% if @business.last_sign_in_at.present? %>
                  <p>마지막 로그인: <%= @business.last_sign_in_at.strftime("%Y년 %m월 %d일 %H:%M") %></p>
                <% end %>
                <% if @business.last_sign_in_ip.present? %>
                  <p>마지막 접속 IP: <%= @business.last_sign_in_ip %></p>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
        
        <div>
          <%= f.label :address, "주소", class: "block text-sm font-medium mb-1" %>
          <%= f.text_area :address, rows: 2, class: "w-full" %>
          <% if @business.errors[:address].any? %>
            <p class="text-red-500 text-sm mt-1"><%= @business.errors[:address].first %></p>
          <% end %>
        </div>
        
        <div class="grid grid-cols-2 gap-4">
          <div>
            <%= f.label :total_debt, "총 채무액", class: "block text-sm font-medium mb-1" %>
            <%= f.number_field :total_debt, min: 0, class: "w-full" %>
            <% if @business.errors[:total_debt].any? %>
              <p class="text-red-500 text-sm mt-1"><%= @business.errors[:total_debt].first %></p>
            <% end %>
          </div>
          
          <div>
            <%= f.label :status, "상태", class: "block text-sm font-medium mb-1" %>
            <%= f.select :status, options_for_select(Business.status_options, @business.status), {}, class: "w-full" %>
            <% if @business.errors[:status].any? %>
              <p class="text-red-500 text-sm mt-1"><%= @business.errors[:status].first %></p>
            <% end %>
          </div>
        </div>
        
        <div>
          <%= f.label :deadline, "마감일", class: "block text-sm font-medium mb-1" %>
          <% 
            deadline_value = @business.deadline ? @business.deadline.strftime("%Y-%m-%dT%H:%M") : nil
            # 시간이 설정되지 않은 경우 00:00으로 기본값 설정
            if deadline_value && deadline_value.end_with?("T00:00")
              deadline_value = deadline_value
            elsif deadline_value.nil?
              deadline_value = nil
            end
          %>
          <div class="relative">
            <%= f.datetime_field :deadline, 
                value: deadline_value,
                class: "w-full datetime-input",
                step: 60 %>
          </div>
          <p class="text-sm text-zinc-400 mt-1">이 날짜 이후에는 상품 구매가 불가능합니다.</p>
          <% if @business.errors[:deadline].any? %>
            <p class="text-red-500 text-sm mt-1"><%= @business.errors[:deadline].first %></p>
          <% end %>
        </div>
        
        <style>
          /* datetime-local 입력 필드 스타일링 */
          .datetime-input {
            color-scheme: dark;
          }
          
          .datetime-input::-webkit-calendar-picker-indicator {
            filter: invert(1);
            cursor: pointer;
            opacity: 0.8;
            width: 100%;
            height: 100%;
            position: absolute;
            left: 0;
            top: 0;
            margin: 0;
            padding: 0;
            background: transparent;
          }
          
          .datetime-input::-webkit-calendar-picker-indicator:hover {
            opacity: 1;
          }
          
          /* Firefox 지원 */
          .datetime-input {
            position: relative;
          }
        </style>
        
        <div>
          <%= f.label :logo, "로고 이미지", class: "block text-sm font-medium mb-1" %>
          <% if @business.logo.attached? %>
            <div class="mb-2">
              <p class="text-sm text-zinc-400 mb-1">현재 로고:</p>
              <%= image_tag @business.logo, class: "w-32 h-32 object-cover rounded" %>
            </div>
          <% end %>
          <%= f.file_field :logo, class: "w-full" %>
          <% if @business.errors[:logo].any? %>
            <p class="text-red-500 text-sm mt-1"><%= @business.errors[:logo].first %></p>
          <% end %>
        </div>
        
        <div class="flex gap-4 mt-6">
          <%= f.submit "업체 정보 수정", class: "btn-primary cursor-pointer" %>
          <%= link_to "취소", admin_business_path(@business), class: "btn-secondary" %>
        </div>
      </div>
    <% end %>
  </div>
</div>