#!/usr/bin/env bash
set -e

echo "ğŸš€ EndmarkDebtmall ë°°í¬ ì‹œì‘..."

# 1. í…ŒìŠ¤íŠ¸ ì‹¤í–‰
echo "ğŸ“‹ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘..."
bin/rails test

# 2. ë³´ì•ˆ ê²€ì‚¬
echo "ğŸ”’ ë³´ì•ˆ ê²€ì‚¬ ì¤‘..."
bin/brakeman -q

# 3. ì½”ë“œ ìŠ¤íƒ€ì¼ ê²€ì‚¬
echo "ğŸ¨ ì½”ë“œ ìŠ¤íƒ€ì¼ ê²€ì‚¬ ì¤‘..."
bin/rubocop

# 4. ì—ì…‹ ì»´íŒŒì¼ í™•ì¸
echo "ğŸ“¦ ì—ì…‹ ì»´íŒŒì¼ í…ŒìŠ¤íŠ¸..."
RAILS_ENV=production bin/rails assets:precompile
rm -rf public/assets  # í…ŒìŠ¤íŠ¸ í›„ ì •ë¦¬

# 5. Kamal ë°°í¬
echo "ğŸ³ Docker ì´ë¯¸ì§€ ë¹Œë“œ ë° ë°°í¬..."
bin/kamal deploy

echo "âœ… ë°°í¬ ì™„ë£Œ!"
echo "ğŸ“Š ì„œë²„ ìƒíƒœ í™•ì¸: bin/kamal app details"
echo "ğŸ“ ë¡œê·¸ í™•ì¸: bin/kamal logs"