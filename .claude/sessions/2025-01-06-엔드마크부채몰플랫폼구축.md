# 세션: 2025-01-06 - 엔드마크 부채몰 플랫폼 구축

## 작업 내용
Rails 8.0.2를 사용하여 체육시설 폐업 시 운동기구를 판매하는 중고거래 플랫폼 구축

### 주요 구현 사항
1. **개발 환경 설정**
   - 디버깅 도구: pry-rails, pry-byebug
   - 개발 편의: dotenv-rails, faker, better_errors, binding_of_caller, rails_live_reload, bullet, annotate, letter_opener
   - 코드 품질: rubocop, rubocop-rails, brakeman
   - Bullet N+1 쿼리 감지 설정 완료

2. **데이터베이스 구조**
   - Business (업체): FriendlyId로 slug 생성, logo 이미지 포함
   - Product (상품): 다중 이미지 지원, WebP 자동 변환
   - Admin (관리자): Devise 인증
   - PurchaseRequest (구매요청): 상태 관리 포함

3. **핵심 기능**
   - 업체별 독립 URL (/:business_slug)
   - 상품 목록 페이지 (카테고리 필터, 가격순 정렬)
   - 상품 상세 페이지 (이미지 갤러리, 구매 문의 폼)
   - 관리자 패널 (/admin)
   - 페이지네이션 (Kaminari)

## 주요 결정사항

### 기술 스택 선택
- **Rails 8**: 최신 버전 사용으로 Solid Cache/Queue/Cable 활용
- **Tailwind CSS**: shadcn 스타일의 다크 테마 구현
- **Active Storage**: 이미지 처리 및 WebP 자동 변환
- **FriendlyId**: SEO 친화적인 URL 구현

### UI/UX 설계
- 다크 테마 (배경: #000000, 카드: #18181b, 테두리: #27272a)
- 모바일 우선 반응형 디자인
- shadcn 스타일의 컴포넌트 디자인

## 변경된 파일
### 설정 파일
- Gemfile: 개발 도구 및 필수 gem 추가
- config/routes.rb: RESTful 라우팅 구성
- config/environments/development.rb: Bullet, Letter Opener 설정
- .rubocop.yml: 코드 스타일 규칙
- .env.example: 환경 변수 템플릿

### 모델
- app/models/business.rb: FriendlyId, 검증, 관계 설정
- app/models/product.rb: 이미지 variant, enum, scope 정의
- app/models/purchase_request.rb: 상태 관리, 검증
- app/models/admin.rb: Devise 인증

### 컨트롤러
- app/controllers/businesses_controller.rb: 업체별 상품 목록
- app/controllers/products_controller.rb: 상품 상세
- app/controllers/purchase_requests_controller.rb: 구매 문의
- app/controllers/admin/*.rb: 관리자 CRUD

### 뷰
- app/views/home/index.html.erb: 업체 목록
- app/views/businesses/show.html.erb: 상품 목록
- app/views/products/show.html.erb: 상품 상세 및 구매 문의
- app/views/admin/*: 관리자 패널 전체
- app/views/layouts/admin.html.erb: 관리자 레이아웃

### 스타일
- app/assets/tailwind/application.css: 다크 테마 CSS 변수 및 컴포넌트

### 데이터
- db/seeds.rb: 샘플 데이터 (3개 업체, 9개 상품, 5개 구매요청)

## 사용한 코드 패턴

### Active Record 패턴
```ruby
# Scope 활용
scope :available_products, -> { where(status: :available) }
scope :by_category, ->(category) { where(category: category) if category.present? }

# Enum 활용
enum :status, { active: 0, inactive: 1, closed: 2 }
```

### 이미지 처리
```ruby
has_many_attached :images do |attachable|
  attachable.variant :thumb, resize_to_fill: [300, 300], convert: :webp
  attachable.variant :medium, resize_to_fill: [600, 600], convert: :webp
  attachable.variant :large, resize_to_limit: [1200, 1200], convert: :webp
end
```

### 컨트롤러 패턴
```ruby
before_action :set_business
before_action :authenticate_admin!

private
def set_business
  @business = Business.friendly.find(params[:business_slug])
rescue ActiveRecord::RecordNotFound
  redirect_to root_path, alert: "업체를 찾을 수 없습니다."
end
```

## 다음 세션 참고사항

### 추가 개선 가능 사항
1. 이미지 업로드 기능 (Active Storage Direct Upload)
2. 검색 기능 구현
3. 관리자 대시보드 통계
4. 이메일 알림 기능
5. 실시간 채팅 문의

### 주의사항
- image_processing gem이 ImageMagick 또는 libvips 필요
- 프로덕션 환경에서는 Active Storage를 S3 등으로 설정 필요
- Devise 보안 설정 강화 필요
- CORS 설정 (API 제공 시)

### 테스트 계정
- 관리자: admin@endmark.com / password123
- 샘플 업체 URL: /리웰-휘트니스, /파워짐-신촌점, /요가-스튜디오-선